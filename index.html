<!doctype html>
<html>
<head>
  <title>Test Benchmark</title>
   <meta charset="UTF-8" />
</head>
<body>
  <span id="platform">Unknown platform!</span> <br />
  <span id="final-result">Tests still running...</span> <br /> <br />
  <span id="lodash">running…</span></br />
  <span id="lodashEscaped">running…</span></br />
  <span id="lodashObj">running…</span></br />
  <span id="lodashObjEscaped">running…</span></br />
  <span id="underscore">running…</span></br />
  <span id="underscoreEscaped">running…</span></br />
  <span id="underscoreObj">running…</span></br />
  <span id="underscoreObjEscaped">running…</span></br />

  <script src="js/underscore.js"></script>
  <script type="text/javascript">
    // release _ for lodash ( which is also needed by benchmark.js )
    _underscore = _.noConflict()
  </script>
  <script src="js/lodash.js"></script>
  <script src="js/platform.js"></script>
  <script src="js/benchmark.js"></script>




  <script type="text/javascript">

  var cntr = 8;

  function doBenchmark( name, library, ifObj, ifEscaped ) {
    var bench = new Benchmark( { 
        // defer: true,
        fn: function(deferred) {
        var compiled = library.template( "random:"  
                       + ( ifEscaped ? "<b><%- " : "<%=" )
                       + ( ifObj     ? "obj." : "" )
                       + "number %>!"
                       + ( ifEscaped ? "</b>" : "" ) );
        compiled( { "number": Math.random() } );
	// deferred.resolve();
      }
    });
    // bench.cycles = 1000;
    spanname = name 
		+ ( ifObj     ? "Obj" : "" )
		+ ( ifEscaped ? "Escaped" : "" );
    bench.on( "error", function() {
        document.getElementById(spanname).innerHTML = spanname + " failed!";
        document.getElementById( "final-result" ).innerHTML = "<b>One or more test failed!</b>";	
   });
    bench.on( "complete", function() {
      str = spanname 
		+ " count: "          + this.count 
		+ " elapsed: "        + this.times.elapsed 
		+ " time per cycle: " + this.times.period  
		+ " cycles: "         + this.cycles;
      document.getElementById(spanname).innerHTML = str;
      cntr--;
      if ( cntr == 0 )
        document.getElementById( "final-result" ).innerHTML = "Tests finished!";
    })
    bench.run( { 'async': false } )
  }
  document.getElementById( "platform" ).innerHTML = "Browser: " 
			+ platform.name + " " 
			+ platform.version 
			+ " (" + platform.layout + ")" 
			+ "<br />" + platform.os;
  doBenchmark( "lodash", _, false, false ); // 00
  doBenchmark( "lodash", _, false, true  ); // 01
  doBenchmark( "lodash", _, true,  false ); // 10
  doBenchmark( "lodash", _, true,  true  ); // 11
  doBenchmark( "underscore", _underscore, false, false ); // 00
  doBenchmark( "underscore", _underscore, false, true  ); // 01
  doBenchmark( "underscore", _underscore, true,  false ); // 10
  doBenchmark( "underscore", _underscore, true,  true  ); // 11

  </script>
</body>
</html>
