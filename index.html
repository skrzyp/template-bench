<!doctype html>
<html>
<head>
  <title>Test Benchmark</title>
   <meta charset="UTF-8" />
</head>
<body>
  <span id="platform">Unknown platform!</span> <br />
  <span id="final-result">Tests still running...</span> <br /> <br />
  <span id="lodash">running…</span></br />
  <span id="lodashEscaped">running…</span></br />
  <span id="lodashAsync">running…</span></br />
  <span id="lodashAsyncEscaped">running…</span></br />
  <span id="lodashObj">running…</span></br />
  <span id="lodashObjEscaped">running…</span></br />
  <span id="lodashObjAsync">running…</span></br />
  <span id="lodashObjAsyncEscaped">running…</span></br />
  <span id="underscore">running…</span></br />
  <span id="underscoreEscaped">running…</span></br />
  <span id="underscoreAsync">running…</span></br />
  <span id="underscoreAsyncEscaped">running…</span></br />
  <span id="underscoreObj">running…</span></br />
  <span id="underscoreObjEscaped">running…</span></br />
  <span id="underscoreObjAsync">running…</span></br />
  <span id="underscoreObjAsyncEscaped">running…</span></br />

  <script src="js/underscore.js"></script>
  <script type="text/javascript">
    // release _ for lodash ( which is also needed by benchmark.js )
    _underscore = _.noConflict()
  </script>
  <script src="js/lodash.js"></script>
  <script src="js/platform.js"></script>
  <script src="js/benchmark.js"></script>




  <script type="text/javascript">

  var cntr = 16;

  function doBenchmark( name, library, ifObj, ifAsync, ifEscaped ) {
    var bench = new Benchmark( function () {
        var compiled = library.template( "random:"  
                       + ( ifEscaped ? "<b><%- " : "<%=" )
                       + ( ifObj     ? "obj." : "" )
                       + "number %>!"
                       + ( ifEscaped ? "</b>" : "" ) );
        compiled( { "number": Math.random() } );
      }
    );
    // bench.cycles = 1000;
    spanname = name 
		+ ( ifObj     ? "Obj" : "" )
		+ ( ifAsync   ? "Async" : "" )
		+ ( ifEscaped ? "Escaped" : "" );
    bench.on( "error", function() {
        document.getElementById(spanname).innerHTML = spanname + " failed!";
	console.log(spanname + " failed!");
        document.getElementById( "final-result" ).innerHTML = "<b>One or more test failed!</b>";	
   });
    bench.on( "complete", function() {
      str = spanname 
		+ " count: "          + this.count 
		+ " elapsed: "        + this.times.elapsed 
		+ " time per cycle: " + this.times.period  
		+ " cycles: "         + this.cycles;
      console.log(spanname + " done!");
      document.getElementById(spanname).innerHTML = str;
      cntr--;
      if ( cntr == 0 )
        document.getElementById( "final-result" ).innerHTML = "Tests finished!";
    })
    if ( ifAsync == true )
       bench.run( { 'async': true } )
    else
       bench.run( { 'async': false } )
  }
  document.getElementById( "platform" ).innerHTML = "Browser: " 
			+ platform.name + " " 
			+ platform.version 
			+ " (" + platform.layout + ")" 
			+ "<br />" + platform.os;
  doBenchmark( "lodash", _, false, false, false ); // 000
  doBenchmark( "lodash", _, false, false, true  ); // 001
  doBenchmark( "lodash", _, false, true,  false ); // 010
  doBenchmark( "lodash", _, false, true,  true  ); // 011
  doBenchmark( "lodash", _, true,  false, false ); // 100
  doBenchmark( "lodash", _, true,  false, true  ); // 101
  doBenchmark( "lodash", _, true,  true,  false ); // 110
  doBenchmark( "lodash", _, true,  true,  true  ); // 111
  doBenchmark( "underscore", _underscore, false, false, false ); // 000
  doBenchmark( "underscore", _underscore, false, false, true  ); // 001
  doBenchmark( "underscore", _underscore, false, true,  false ); // 010
  doBenchmark( "underscore", _underscore, false, true,  true  ); // 011
  doBenchmark( "underscore", _underscore, true,  false, false ); // 100
  doBenchmark( "underscore", _underscore, true,  false, true  ); // 101
  doBenchmark( "underscore", _underscore, true,  true,  false ); // 110
  doBenchmark( "underscore", _underscore, true,  true,  true  ); // 111

  </script>
</body>
</html>
